## ğŸ“¦  AIâ€‘IDE â€œProductionâ€‘Readyâ€ Functional Spec  
*(Think of it as a leanâ€‘down version of VSâ€¯Code / Zed that **never** ships with a missing button, a broken connection, or an undocumented shortcut.)*  

Below is a **complete, hierarchical checklist** of everything the project must containâ€”**frontâ€‘end**, **backâ€‘end**, **infrastructure**, **testing**, **documentation**, and **operations**.  
Treat each bullet as a *gate* that has to pass before you cut a release. If any gate fails, the CI pipeline blocks the merge, so the IDE works **the first time** it lands in production.

---

## 1ï¸âƒ£ Core Userâ€‘Facing Features (What the user sees)

| # | Feature | UI Element(s) | Behaviour | Mustâ€‘Have? |
|---|---------|---------------|-----------|-----------|
| 1 | **File Explorer** | Sidebar tree, **Newâ€¯File**, **Newâ€¯Folder**, **Rename**, **Delete**, **Refresh** icons | - Lazyâ€‘load directories. <br>- Inline rename with validation (no duplicate names, no illegal characters). <br>- Contextâ€‘menu (rightâ€‘click) with the same actions. | âœ… |
| 2 | **Multiâ€‘Tab Editor** | Top tab bar, closeâ€¯Ã—, dragâ€‘toâ€‘reorder, **pin** icon | - Each tab shows the filename and unsaved *dot* indicator. <br>- Switching tabs instantly loads the file content from the workspace service. <br>- Pin prevents accidental close. | âœ… |
| 3 | **CodeMirrorâ€¯6 Editor** | Syntaxâ€‘highlight, line numbers, folding, autoâ€‘indent, **FIM** autocomplete | - Languageâ€‘specific extensions (JS/TS, Python, Go, etc.). <br>- AIâ€‘completion triggered on `Ctrl+Space` **or** as you type (configurable). <br>- Show loading spinner while AI request is in flight. | âœ… |
| 4 | **AI Assistant Panel** | Bottom drawer, chat window, **model selector** dropdown, **send** button, **clear** button | - Streams responses from the backend (`/ai/complete`). <br>- Persists conversation in `localStorage` (or workspace DB) per project. <br>- Model selector updates the request header (`Xâ€‘Model`). | âœ… |
| 5 | **Git Integration** | Toolbar with **Init**, **Status**, **Pull**, **Push**, **Commit**, **Branch** dropdown, **Diff** view | - All actions call the `/git/*` API. <br>- Show toast notifications on success/failure. <br>- Diff view uses a sideâ€‘byâ€‘side readâ€‘only CodeMirror with inline markers. | âœ… |
| 6 | **Terminal Emulator (optional for MVP)** | Collapsible bottom pane, **run** button, **clear** button | - Connects to a backend PTY via WebSocket (`/ws/terminal`). <br>- Sends keystrokes, receives output, supports Ctrlâ€¯+C. | âšªï¸ (niceâ€‘toâ€‘have) |
| 7 | **Theme System** | Header toggle (Sun/Moon), **light/dark/pureâ€‘black** modes | - Persists choice in `localStorage`. <br>- Tailwind config uses CSS variables for easy theming. | âœ… |
| 8 | **Toast Notification System** | Topâ€‘right stack, autoâ€‘dismiss after 4â€¯s, **error** (red), **info** (blue), **success** (green) | - API: `useToast().add({message, type})`. <br>- Accessible (ARIA roleâ€¯=â€¯alert). | âœ… |
| 9 | **Keyboard Hotâ€‘keys** | Global listener (via `useHotkeys`) | - `Ctrl+S`â€¯â†’â€¯Save current file. <br>- `Ctrl+N`â€¯â†’â€¯New file. <br>- `Ctrl+O`â€¯â†’â€¯Open explorer. <br>- `Ctrl+Shift+S`â€¯â†’â€¯Saveâ€¯All. <br>- `Ctrl+/, Ctrl+D`â€¯â†’â€¯Toggle comment. <br>- `Ctrl+F`â€¯â†’â€¯Find. <br>- `Ctrl+H`â€¯â†’â€¯Replace. <br>- `Ctrl+` (backâ€‘tick)â€¯â†’â€¯Toggle terminal. | âœ… |
|10| **Settings Modal** | Gear icon â†’ modal with tabs (**General**, **AI**, **Git**, **Keyboard**, **Theme**) | - Persist all values in `localStorage` (or a tiny JSON file in the workspace). <br>- Validate on save (e.g., API keys are nonâ€‘empty). | âœ… |
|11| **Errorâ€‘Boundary UI** | Fullâ€‘screen fallback UI (red banner) | - Catches any uncaught React error, shows a â€œSomething went wrongâ€ screen with a **Report** button that sends logs to a GitHub issue via the backend. | âœ… |
|12| **Responsive Layout** | Works on 1024â€¯pxâ€¯+â€¯, collapses sidebar on <â€¯768â€¯px (hamburger menu) | - All controls remain reachable via keyboard shortcuts. | âœ… |

> **Tip:** Build each UI element as a **Storybook** story first. That guarantees the component exists, is testable, and canâ€™t be forgotten later.

---

## 2ï¸âƒ£ Backend API Surface (What the server must expose)

| Endpoint | Method | Payload | Success Response | Failure Cases (statusâ€¯code) | Mustâ€‘Have |
|----------|--------|---------|-------------------|-----------------------------|-----------|
| `/health` | GET | â€“ | `{status:"ok"}` | 500 (if any internal dependency fails) | âœ… |
| `/workspace/files` | GET | `{path?: string}` | `{files:[{name, type, size, modified}]}` | 404 (invalid path) | âœ… |
| `/workspace/file` | GET | `{path}` | `{content:string}` | 404 (not found) | âœ… |
| `/workspace/file` | POST | `{path, content}` | `{message:"saved"}` | 400 (validation), 500 (IO) | âœ… |
| `/workspace/file` | DELETE | `{path}` | `{message:"deleted"}` | 404, 500 | âœ… |
| `/git/init` | POST | `{repoRoot}` | `{message:"initialized"}` | 400, 500 | âœ… |
| `/git/status` | GET | `{repoRoot}` | `{status:"clean|dirty", changes:[...]}` | 400, 500 | âœ… |
| `/git/commit` | POST | `{message, files?}` | `{hash}` | 400, 500 | âœ… |
| `/git/pull` | POST | `{remote, branch}` | `{merged:true}` | 409 (conflict), 500 | âœ… |
| `/git/push` | POST | `{remote, branch}` | `{pushed:true}` | 409, 500 | âœ… |
| `/ai/complete` | POST | `{model, prompt, maxTokens?, temperature?}` | *streamed* JSON `{token}` events | 400 (bad model), 401 (missing API key), 500 | âœ… |
| `/ai/models` | GET | â€“ | `{models:[{id, name, provider}]}` | 500 | âœ… |
| `/logs` | POST | `{level, message, meta}` | `{ok:true}` | 400, 500 | âšªï¸ (optional for errorâ€‘reporting) |
| `/report` | POST | `{error, logs}` | `{ticketUrl}` | 400, 500 | âšªï¸ (niceâ€‘toâ€‘have) |

All endpoints must:

* Return **JSON** with `Contentâ€‘Type: application/json`.
* Validate **input** (use `zod` or `joi` schema).  
* Log **requestâ€‘id** (UUID) and correlate logs across services.  
* Have **CORS** configured to accept the Vercel domain *only* (or any `*.vercel.app` in dev).  

---

## 3ï¸âƒ£ Infrastructure & Deployment (How it runs)

| Layer | Requirement | Implementation |
|-------|-------------|----------------|
| **Containerisation** | Reproducible builds, isolated env. | `Dockerfile` for backend + frontend. Use multiâ€‘stage builds to keep final images <â€¯300â€¯MB. |
| **Compose / Orchestration** | Oneâ€‘click local dev & CI. | `dockerâ€‘compose.yml` with healthâ€‘checks & `restart: unless-stopped`. |
| **Environmentâ€‘Variable Management** | No secrets in code. | `.env.example` + `.env.vercel.example`. CI injects `CODESTRAL_API_KEY`, `HF_TOKEN`, `VITE_API_URL`, `VITE_WS_URL`. |
| **CI/CD** | Failâ€‘fast, lint, typeâ€‘check, build, test, deploy. | GitHub Actions workflow (see Sectionâ€¯5). |
| **Production Host** | Frontend on Vercel (static + serverless), backend on Railway/Render/Heroku (or Vercel Functions). | `vercel.json` with `buildCommand: bash vercelâ€‘build.sh`. Backend exposed as `https://api.<yourâ€‘domain>.com`. |
| **Static Assets CDN** | Fast asset delivery. | Vercelâ€™s builtâ€‘in CDN (no extra config). |
| **Observability** | Immediate insight into crashes. | - Structured logs (JSON) â†’ Vercel/Render logs. <br>- Healthâ€‘check endpoint. <br>- Optional Sentry integration (send errors from frontâ€‘end). |
| **Rollback** | Oneâ€‘click revert. | Tag releases (`git tag -a v1.0.0 â€¦`) and enable Vercel â€œDeployments â†’ Rollbackâ€. |
| **Secrets Rotation** | No stale keys. | Use Railway/Render secret manager; Vercel environment variables can be rotated via UI. |
| **Scalability** | Ability to add more users. | Backend runs as a stateless Express service; horizontal scaling is trivial (Docker Swarm/K8s). Workspace files are stored in a mounted volume (`/workspace`) â€“ for production you can replace it with an NFS or S3â€‘backed FS. |

---

## 4ï¸âƒ£ Quality Assurance (Never ship a missing button)

| Gate | Tool | What it validates |
|------|------|-------------------|
| **Unit Tests** | Jest (backend) + Vitest (frontend) | Pure functions, API service wrappers, reducers, hook logic. |
| **Component Tests** | React Testing Library + Storybook â€œa11yâ€ addon | Each UI component renders, responds to props, has correct ARIA attributes. |
| **Endâ€‘toâ€‘End Tests** | Playwright (or Cypress) | - Open IDE, create a file, type code, hit `Ctrl+Space` â†’ AI suggestion appears.<br>- Commit a change â†’ toast â€œCommit successfulâ€.<br>- Switch theme â†’ UI colors change.<br>- Disconnect network â†’ UI shows â€œOfflineâ€ banner, retries automatically. |
| **Lint & Formatting** | ESLint + Prettier (enforced via husky preâ€‘commit) | No lint errors, consistent code style. |
| **Type Safety** | TypeScript `strict` mode + `noImplicitAny` | Guarantees compileâ€‘time contract enforcement. |
| **Accessibility** | axe-core (storybook) + manual keyboard navigation test | All interactive elements reachable via Tab, have visible focus rings, proper `aria-label`s. |
| **Performance Budget** | Lighthouse CI (as part of GitHub Actions) | Firstâ€‘paint <â€¯800â€¯ms, bundle size <â€¯1â€¯MB gzipped. |
| **Security Scan** | npm audit + Snyk (CI step) | No known vulnerabilities in dependencies. |
| **Snapshot/Visual Regression** | Storybook Chromatic (optional) | Detects accidental UI regressions (e.g., a missing button). |
| **Release Checklist** | `DEPLOYMENT_CHECKLIST.md` (humanâ€‘readable) + CI gate that fails if any unchecked item remains. | Guarantees the â€œfirstâ€‘timeâ€‘rightâ€ promise. |

**Result:** If any test or lint step fails, the PR cannot be merged; the CI blocks it automatically.

---

## 5ï¸âƒ£ Detailed CI Workflow (GitHub Actions)

```yaml
name: CI / Deploy

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      # ----- Checkout & Node -------------------------------------------------
      - uses: actions/checkout@v4
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      # ----- Install root + workspaces ---------------------------------------
      - name: Install monorepo deps
        run: npm ci

      # ----- Lint & Typeâ€‘check ------------------------------------------------
      - name: Lint & typeâ€‘check
        run: |
          npm run lint
          npm run typecheck

      # ----- Unit / Component tests -------------------------------------------
      - name: Run Jest/Vitest
        run: npm test --workspaces --if-present

      # ----- Build frontend (Vercel style) ------------------------------------
      - name: Build frontend
        working-directory: ./frontend
        run: |
          npm ci
          npm run build

      # ----- Docker healthâ€‘check (optional if backend in Docker) -------------
      - name: Docker compose up (healthâ€‘check)
        run: |
          docker compose up -d --build
          timeout 60 bash -c '
            until [ "$(docker inspect -f "{{.State.Health.Status}}" ai-ide-backend-1)" = "healthy" ]; do sleep 2; done
            until [ "$(docker inspect -f "{{.State.Health.Status}}" ai-ide-frontend-1)" = "healthy" ]; do sleep 2; done
          '

      # ----- Smoke test (fast) -------------------------------------------------
      - name: Smoke test
        run: |
          curl -f http://localhost:4000/health
          curl -f http://localhost:5173/

      # ----- Endâ€‘toâ€‘End Playwright tests ---------------------------------------
      - name: Install Playwright browsers
        run: npx playwright install --with-deps
      - name: Run Playwright E2E
        run: npx playwright test

      # ----- Lint storybook (visual regression) -------------------------------
      - name: Storybook test (optional)
        run: npx storybook:test

      # ----- Security audit ----------------------------------------------------
      - name: npm audit
        run: npm audit --audit-level=high

      # ----- Deploy to Vercel (only on main) ---------------------------------
      - name: Deploy Frontend to Vercel
        if: github.ref == 'refs/heads/main'
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./frontend
          prod: true
```

*All steps are **required**; if any fails, the workflow aborts and the merge is blocked.*

---

## 6ï¸âƒ£ Documentation & Knowledge Transfer

| Document | Owner | Contents |
|----------|-------|----------|
| `README.md` | Maintainer | Quickâ€‘start, architecture diagram, how to run locally, how to add a new AI model. |
| `DEPLOYMENT_CHECKLIST.md` | DevOps | Exact list of items to verify before a push (see Sectionâ€¯3). |
| `VERCEL_DEPLOYMENT.md` | DevOps | Vercelâ€‘specific envâ€‘vars, `vercel.json` explanation, troubleshooting build logs. |
| `API_SPEC.md` | Backend lead | Full OpenAPIâ€‘style spec (paths, schemas, error codes). |
| `CONTRIBUTING.md` | Team lead | Code style, preâ€‘commit hook description, testing workflow, how to open a PR. |
| `DESIGN_SYSTEM.md` | UI/UX | Component library (Tailwind + custom components), color palette (including pureâ€‘black theme), icon set, accessibility guidelines. |
| `EXTENSION_GUIDE.md` | Futureâ€‘proofing | How to add a new panel (e.g., a terminal) or a VSâ€¯Codeâ€‘like extension point. |
| `CHANGELOG.md` | Release manager | Semanticâ€‘versioned changelog (autoâ€‘generated with `standard-version`). |

All docs live in the repo and are **rendered automatically** by GitHub (Markdown) and by Storybook (component docs).

---

## 7ï¸âƒ£ Roadmap â€“ MVP â†’ V1 â†’ V2

| Milestone | Scope | Acceptance Criteria |
|-----------|-------|---------------------|
| **MVP (core IDE)** | File explorer, multiâ€‘tab editor, AI autocomplete, theme toggle, toast system, hotâ€‘keys, basic git (`init`, `status`, `commit`). | All UI components render; `npm run test` passes; CI green; Vercel deploys; manual QA: create a file, type code, get AI suggestion, commit â†’ toast â€œCommit successfulâ€. |
| **V1 (productâ€‘ready)** | Add AI chat panel, diff view, settings modal, full git workflow (`pull`, `push`, `branch`), errorâ€‘boundary UI, responsive layout, Playwright E2E suite. | Same CI pass, plus 100â€¯% coverage of UI interactions in Playwright. |
| **V2 (deluxe)** | Terminal emulator, extension API (plugâ€‘in loader), workspace persistence to cloud storage (S3), multiâ€‘user auth (OAuth), darkâ€‘mode sync with OS, telemetry (optional). | New features pass their own unit/E2E tests; no regression in existing tests; CI still green. |

Each milestone **must** be gated by the checklist and CI pipelineâ€”nothing is merged without it.

---

## 8ï¸âƒ£ How to Prevent â€œForgot a Buttonâ€ or â€œBroken Connectionâ€ Bugs

| Problem | Preventive Pattern |
|---------|--------------------|
| UI element missing from a screen (e.g., â€œSaveâ€ button) | **Storybook** + **visual regression** (Chromatic) â†’ every component is a story; CI fails if a story disappears. |
| API endpoint not wired to UI | **Contract testing**: generate a **typeâ€‘safe client** from the OpenAPI spec (`openapi-generator`) and import it in the frontâ€‘end. If the endpoint changes, TypeScript compilation fails. |
| Wrong env var â†’ backend canâ€™t reach AI provider | **Envâ€‘validation** (see Sectionâ€¯2). The server exits with a clear error before the container becomes healthy; CI healthâ€‘check catches it. |
| Hotâ€‘key clash / not registered | Central **hotâ€‘key registry** (`useHotkeys` hook) that throws if a duplicate shortcut is registered. Unit test that registers all shortcuts and asserts uniqueness. |
| Git operation silently fails | All git service calls return a JSON `{ok:true}` **or** an error with `code` and `message`. UI shows a toast for every nonâ€‘200 response. |
| Layout breaks on small screens | **Responsive Storybook stories** (Viewport addon) + automated screenshot diff in CI. |
| Deployment works locally but not on Vercel | **Docker healthâ€‘check** + **CI smoke test** run **exactly** the same commands Vercel runs (`vercel-build.sh`). If CI passes, Vercel will also pass. |
| Missing translation / ARIA label | **eslint-plugin-jsx-a11y** + **eslint-plugin-react-i18next** (if i18n). CI fails on missing `aria-label` or untranslated strings. |

---

## 9ï¸âƒ£ Oneâ€‘Click â€œAllâ€‘Clearâ€ Script (Run before you push)

```bash
#!/usr/bin/env bash
set -euo pipefail

echo "=== 1ï¸âƒ£ Lint & typeâ€‘check ==="
npm run lint && npm run typecheck

echo "=== 2ï¸âƒ£ Unit / component tests ==="
npm test --workspaces

echo "=== 3ï¸âƒ£ Build frontend (Vercel) ==="
(cd frontend && npm ci && npm run build)

echo "=== 4ï¸âƒ£ Docker healthâ€‘check (if using Docker) ==="
docker compose up -d --build
timeout 60 bash -c '
  until [ "$(docker inspect -f "{{.State.Health.Status}}" ai-ide-backend-1)" = "healthy" ]; do sleep 2; done
  until [ "$(docker inspect -f "{{.State.Health.Status}}" ai-ide-frontend-1)" = "healthy" ]; do sleep 2; done
'

echo "=== 5ï¸âƒ£ Smoke test ==="
curl -f http://localhost:4000/health
curl -f http://localhost:5173/

echo "=== 6ï¸âƒ£ Endâ€‘toâ€‘end Playwright tests ==="
npx playwright test

echo "=== 7ï¸âƒ£ Tear down ==="
docker compose down

echo "âœ… All checks passed â€“ you can push now!"
```

Add it to `package.json`:

```json
"scripts": {
  "prepush": "bash ./scripts/prepush-checks.sh"
}
```

Now `git push` automatically runs the script (via the Git hook you created) and aborts on the first failure.

---

## ğŸ“Œ TL;DR â€“ What to **actually implement** right now

1. **Add every UI component to Storybook** (Explorer, Tabs, Editor, Chat, GitPanel, Settings, Toast, ThemeToggle).  
2. **Write OpenAPI spec** (`api-spec.yaml`) and generate a **typed client** (`npm run generate:client`).  
3. **Implement envâ€‘validation** (`src/config.ts` + Vite validator).  
4. **Add Docker healthâ€‘checks & restart policies**.  
5. **Create preâ€‘commit & preâ€‘push hooks** (lint, typeâ€‘check, Docker healthâ€‘check).  
6. **Set up full CI pipeline** (lint â†’ type â†’ unit â†’ build â†’ smoke â†’ e2e â†’ security).  
7. **Write the deployment checklist** and keep it in `DEPLOYMENT_CHECKLIST.md`.  
8. **Run the â€œallâ€‘clearâ€ script** before each push.  
9. **Deploy to Vercel** (frontend) + Railway/Render (backend) and verify the CI passes.  

Once those nine steps are in place, **every merge will be a greenâ€‘light release**, and the IDE will work correctly **the first time** it lands in productionâ€”no missing buttons, no broken connections, no hidden surprises.  

Feel free to ask for any of the concrete files (e.g., a sample `apiâ€‘spec.yaml`, a Storybook config, or the exact `vercelâ€‘build.sh` script) and Iâ€™ll drop them into the repo for you. ğŸš€